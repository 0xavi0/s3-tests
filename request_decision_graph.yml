start:
    set:
        garbage:
            - {random 10-3000 printable}
            - {random 10-1000 binary}
    choices:
        - bucket

bucket:
    set:
        urlpath: /{bucket}
    choices:
        - 13 bucket_get
        - 8 bucket_put
        - 5 bucket_delete
        - garbage_method

garbage_method:
    set:
        method:
            - {random 1-100 printable}
            - {random 10-100 binary}
        urlpath:
            - /{bucket}
            - /{bucket}/{object}
            - {random 10-1000 binary}
    choices:
        - bucket_get_simple
        - bucket_get_filtered
        - bucket_get_uploads
        - bucket_put_create
        - bucket_put_versioning
        - bucket_put_simple

bucket_delete:
    set:
        method: DELETE
        bucket:
            - {bucket_writable}
            - {bucket_not_writable}
            - 2 {garbage}
        query:
            - null
            - policy
            - website
            - 2 {garbage}
    choices: []

bucket_get:
    set:
        method: GET
        bucket:
            - {bucket_readable}
            - {bucket_not_readable}
            - 2 {garbage}
    choices:
        - 11 bucket_get_simple
        - bucket_get_filtered
        - bucket_get_uploads

bucket_get_simple:
    set:
        query:
            - acl
            - policy
            - location
            - logging
            - notification
            - versions
            - requestPayment
            - versioning
            - website
            - 2 {garbage}
    choices: []

bucket_get_uploads:
    set:
        delimiter:
            - null
            - 3 'delimiter={garbage}'
        prefix:
            - null
            - 3 'prefix={garbage}'
        key_marker:
            - null
            - 'key-marker={object_readable}'
            - 'key-marker={object_not_readable}'
            - 'key-marker={invalid_key}'
            - 'key-marker={random 100-1000 printable}'
        max_uploads:
            - null
            - 'max-uploads={random 1-5 binary}'
            - 'max-uploads={random 1-1000 digits}'
        upload_id_marker:
            - null
            - 3 'upload-id-marker={random}'
        query:
            - 'uploads'
            - 'uploads&{delimiter}&{prefix}'
            - 'uploads&{max_uploads}&{key_marker}&{upload_id_marker}'
            - 2 {garbage}
    choices: []

bucket_get_filtered:
    set:
        delimiter:
            - 'delimiter={garbage}'
        prefix:
            - 'prefix={garbage}'
        marker:
            - 'marker={object_readable}'
            - 'marker={object_not_readable}'
            - 'marker={invalid_key}'
            - 'marker={random 100-1000 printable}'
        max_keys:
            - 'max-keys={random 1-5 binary}'
            - 'max-keys={random 1-1000 digits}'
        query:
            - null
            - '{delimiter}&{prefix}'
            - '{max-keys}&{marker}'
            - 2 {garbage}
    choices: []

bucket_put:
    set:
        bucket:
            - {bucket_writable}
            - {bucket_not_writable}
            - 2 {garbage}
        method: PUT
    choices:
        - bucket_put_simple
        - bucket_put_create
        - bucket_put_versioning

bucket_put_create:
    set:
        body:
            - 2 {garbage}
            - '<CreateBucketConfiguration><LocationConstraint>{random 2-10 binary}</LocationConstraint></CreateBucketConfiguration>'
        acl:
            - private
            - {random 3000 letters}
            - {random 100-1000 binary}
    headers:
        - ['0-1', 'x-amz-acl', '{acl}']
    choices: []

bucket_put_versioning:
    set:
        body:
            - {garbage}
            - 4 '<VersioningConfiguration>{versioning_status}{mfa_delete_body}</VersioningConfiguration>'
        mfa_delete_body:
            - null
            - '<Status>{random 2-10 binary}</Status>'
            - '<Status>{random 2000-3000 printable}</Status>'
        versioning_status:
            - null
            - '<MfaDelete>{random 2-10 binary}</MfaDelete>'
            - '<MfaDelete>{random 2000-3000 printable}</MfaDelete>'
        mfa_header:
            - '{random 10-1000 printable} {random 10-1000 printable}'
    headers:
        - ['0-1', 'x-amz-mfa', '{mfa_header}']
    choices: []

bucket_put_simple:
    set:
        body:
            - {acl_body}
            - {policy_body}
            - {logging_body}
            - {notification_body}
            - {request_payment_body}
            - {website_body}
        acl_body:
            - null
            - '<AccessControlPolicy>{owner}{acl}</AccessControlPolicy>'
        owner:
            - null
            - 7 '<Owner>{id}{display_name}</Owner>'
        id:
            - null
            - '<ID>{random 10-200 binary}</ID>'
            - '<ID>{random 1000-3000 printable}</ID>'
        display_name:
            - null
            - 2 '<DisplayName>{random 10-200 binary}</DisplayName>'
            - 2 '<DisplayName>{random 1000-3000 printable}</DisplayName>'
            - 2 '<DisplayName>{random 10-300 letters}@{random 10-300 letters}.{random 2-4 letters}</DisplayName>'
        acl:
            - null
            - 10 '<AccessControlList><Grant>{grantee}{permission}</Grant></AccessControlList>'
        grantee:
            - null
            - 7 '<Grantee xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="CanonicalUser">{id}{display_name}</Grantee>'
        permission:
            - null
            - 7 '<Permission>{permission_value}</Permission>'
        permission_value:
            - 2 {garbage}
            - FULL_CONTROL
            - WRITE
            - WRITE_ACP
            - READ
            - READ_ACP
        policy_body:
            - null
            - 2 {garbage}
        logging_body:
            - null
            - '<BucketLoggingStatus xmlns="http://doc.s3.amazonaws.com/2006-03-01" />'
            - '<BucketLoggingStatus xmlns="http://doc.s3.amazonaws.com/2006-03-01"><LoggingEnabled>{bucket}{target_prefix}{target_grants}</LoggingEnabled></BucketLoggingStatus>'
        target_prefix:
            - null
            - '<TargetPrefix>{random 10-1000 printable}</TargetPrefix>'
            - '<TargetPrefix>{random 10-1000 binary}</TargetPrefix>'
        target_grants:
            - null
            - 10 '<TargetGrants><Grant>{grantee}{permission}</Grant></TargetGrants>'
        notification_body:
            - null
            - '<NotificationConfiguration />'
            - 2 '<NotificationConfiguration><TopicConfiguration>{topic}{event}</TopicConfiguration}</NotificationConfiguration>'
        topic:
            - null
            - 2 '<Topic>{garbage}</Topic>'
        event:
            - null
            - '<Event>s3:ReducedRedundancyLostObject</Event>'
            - 2 '<Event>{garbage}</Event>'
        request_payment_body:
            - null
            - '<RequestPaymentConfiguration xlmns="http://s3.amazonaws.com/doc/2006-03-01/"><Payer>{payer}</Payer></RequestPaymentConfiguration>'
        payer:
            - Requester
            - BucketOwner
            - 2 {garbage}
        website_body:
            - null
            - '<WebsiteConfiguration xmlns="http://s3.amazonaws.com/doc/2006-03-01/"><IndexDocument><Suffix>{suffix}</Suffix><IndexDocument>{error_doc}<WebsiteConfiguration/>'
        suffix:
            - null
            - 2 {garbage}
            - '{random 2-10 printable}.html'
        error_doc:
            - null
            - '<ErrorDocument><Key>{suffix}</Key></ErrorDocument>'
    choices: []

